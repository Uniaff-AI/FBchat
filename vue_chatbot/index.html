// Chatbot.vue
<template>
  <div class="chatbot-container">
    <div class="chat-messages" ref="chatMessages">
      <div v-for="(message, index) in messages" :key="index" :class="['message', message.type]">
        {{ message.content }}
      </div>
    </div>
    <div class="chat-input">
      <input v-model="userInput" @keyup.enter="sendMessage" placeholder="Type your message here..." />
      <button @click="sendMessage">Send</button>
    </div>
  </div>
</template>

<script>
import { ref, onMounted, onUnmounted, nextTick } from 'vue';

export default {
  name: 'Chatbot',
  setup() {
    const messages = ref([]);
    const userInput = ref('');
    const socket = ref(null);
    const chatMessages = ref(null);

    const connectWebSocket = () => {
      socket.value = new WebSocket('ws://localhost:8000/ws/chatbot'); // Adjust the URL to match your backend

      socket.value.onopen = () => {
        console.log('WebSocket connected');
        addMessage('Welcome! How can I help you today?', 'assistant');
      };

      socket.value.onmessage = (event) => {
        const response = JSON.parse(event.data);
        addMessage(response.message, 'assistant');
      };

      socket.value.onerror = (error) => {
        console.error('WebSocket error:', error);
      };

      socket.value.onclose = () => {
        console.log('WebSocket disconnected');
      };
    };

    const addMessage = (content, type) => {
      messages.value.push({ content, type });
      nextTick(() => {
        if (chatMessages.value) {
          chatMessages.value.scrollTop = chatMessages.value.scrollHeight;
        }
      });
    };

    const sendMessage = () => {
      if (userInput.value.trim() === '') return;

      addMessage(userInput.value, 'user');
      socket.value.send(JSON.stringify({ message: userInput.value }));
      userInput.value = '';
    };

    onMounted(() => {
      connectWebSocket();
    });

    onUnmounted(() => {
      if (socket.value) {
        socket.value.close();
      }
    });

    return {
      messages,
      userInput,
      sendMessage,
      chatMessages,
    };
  },
};
</script>

<style scoped>
.chatbot-container {
  width: 100%;
  max-width: 600px;
  margin: 0 auto;
  border: 1px solid #ccc;
  border-radius: 8px;
  overflow: hidden;
}

.chat-messages {
  height: 400px;
  overflow-y: auto;
  padding: 20px;
}

.message {
  margin-bottom: 10px;
  padding: 10px;
  border-radius: 8px;
}

.user {
  background-color: #e6f7ff;
  text-align: right;
}

.assistant {
  background-color: #f0f0f0;
}

.chat-input {
  display: flex;
  padding: 10px;
}

input {
  flex-grow: 1;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

button {
  margin-left: 10px;
  padding: 8px 16px;
  background-color: #1890ff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

button:hover {
  background-color: #40a9ff;
}
</style>